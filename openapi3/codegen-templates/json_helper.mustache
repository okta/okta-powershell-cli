{{> partial_header}}

# Remove null properties from an object recursively

function Remove-NullProperties {
    [CmdletBinding()]
    param(
        [Parameter(Mandatory, Position = 0, ValueFromPipeline)]
        [object]
        $InputObject
    )

    $NewObject = @{ }
    
    if ($InputObject -is [string] -or $InputObject.GetType().IsPrimitive) {
        return $InputObject
    }
    elseif ($InputObject -is [System.Collections.IDictionary]) {
        $NewObject = Remove-NullPropertiesFromHashMap($InputObject)
    }
    elseif ($InputObject -is [array]){
        $NewObject = Remove-NullPropertiesFromArray($InputObject)
    }
    else{
        $PropertyList = $InputObject.PSObject.Properties | Where-Object { $null -ne $_.Value }
        
        foreach ($Property in $PropertyList) { 
            $NewObject[$Property.Name] = Remove-NullProperties $Property.Value
        }
    }

    return [PSCustomObject]$NewObject  
}

# Remove null properties from hashtable recursively

function Remove-NullPropertiesFromHashMap{
    [CmdletBinding()]
    param(
        [AllowEmptyCollection()]
        [Parameter(Mandatory, Position = 0, ValueFromPipeline)]
        [System.Collections.IDictionary]
        $InputObject
    )
    
    $OutputHashtable = @{}
    foreach ($Key in $InputObject.Keys) {
        $Value = $InputObject[$Key]
        $CleanedValue = Remove-NullProperties $Value
        if ($null -ne $CleanedValue) {
            $OutputHashtable[$Key] = $CleanedValue
        }
    }
    return $OutputHashtable
}

# Remove null properties from an array recursively

function Remove-NullPropertiesFromArray {
    [CmdletBinding()]
    param(
        [AllowEmptyCollection()]
        [Parameter(Mandatory, Position = 0, ValueFromPipeline)]
        [array]
        $InputArray
    )
    [array]$NewArray = @()
    
    foreach ($Item in $InputArray) {
        $NewItem = Remove-NullProperties($Item)
        $NewArray += $NewItem
    }

    return $NewArray
}